# Salesforce破壊的変更デプロイ支援ツール開発計画

## 概要
Salesforceのデプロイにおける破壊的変更（リソース削除）時の依存関係エラーを自動で解決するCLIツールを開発する。
以下の2つのアプローチを実装し、ユーザーが選択して実行できるようにする。

1.  **アプローチ3 (Git差分ベース)**: `sfdx-git-delta` を利用し、ブランチ間の差分からデプロイパッケージを生成し、依存関係を自動解決する。
2.  **アプローチ4 (組織スナップショット比較ベース)**: Salesforce組織の状態を直接取得し、ローカルソースとの差分からデプロイパッケージを生成する。

## 進捗状況
**フェーズ1: アプローチ3の実装完了。**

---

## フェーズ1: アプローチ3 (Git差分ベースのデプロイ)

このフェーズでは、`sfdx-git-delta` を活用したデプロイ自動化を実装する。

- [x] **タスク1.1: 基本的なシェルスクリプトの作成**
- [x] **タスク1.2: `sfdx-git-delta` の実行と差分パッケージの生成**
- [x] **タスク1.3: 破壊的変更内容の解析**
- [x] **タスク1.4: 依存関係の検索**
- [x] **タスク1.5: ソースコードの一時的な無害化処理**
- [x] **タスク1.6: デプロイコマンドの実行**
- [x] **タスク1.7: クリーンアップ処理の実装**
- [x] **タスク1.8: エラーハンドリングとユーザーフィードバック**

---

## フェーズ2: アプローチ4 (組織スナップショット比較ベースのデプロイ)

このフェーズでは、Gitに依存せず、Salesforce組織の状態を正としてデプロイパッケージを生成する機能を実装する。

- [ ] **タスク2.1: モード選択機能の追加**
- [ ] **タスク2.2: 組織スナップショットの取得**
- [ ] **タスク2.3: ローカルソースとの差分比較**
- [ ] **タスク2.4: 差分解析とマニフェスト生成**
- [ ] **タスク2.5: デプロイとクリーンアップ処理の統合**

---

## 作業記録 (2025-07-02)

**状況:**
- フェーズ1「アプローチ3 (Git差分ベースのデプロイ)」の全タスクが完了。
- `sfdx-deploy-helper.sh` スクリプトは、Gitブランチ間の差分を基にした破壊的変更時の依存関係自動解決とデプロイを実行できる状態になった。

**中断理由:**
- ユーザーの指示により、フェーズ1完了をもって一旦作業を中断。

**次回作業:**
- フェーズ2「アプローチ4 (組織スナップショット比較ベースのデプロイ)」に着手する。
- 具体的には、タスク2.1「モード選択機能の追加」から開始する。